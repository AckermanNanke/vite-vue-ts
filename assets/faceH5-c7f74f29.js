var n=Object.defineProperty;var l=(r,e,t)=>e in r?n(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var a=(r,e,t)=>(l(r,typeof e!="symbol"?e+"":e,t),t);import{d as h,r as c,o as v,c as f,f as d,F as u,b as p,_ as R}from"./index-d6c8d9c5.js";let g=class{constructor(e){a(this,"isStartRecord",!1);a(this,"videoEl");a(this,"MediaRecorderOptions",{videoBitsPerSecond:2e5});a(this,"MediaOptions");a(this,"videoRecorder");a(this,"videoStream");a(this,"videoBlob");a(this,"chunks",[]);a(this,"isIOS",!!navigator.userAgent.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/));this.videoEl=e.videoEl,e.MediaOptions&&(this.MediaOptions=e.MediaOptions),e.MediaRecorderOptions&&(this.MediaRecorderOptions=Object.assign({},this.MediaRecorderOptions,e.MediaRecorderOptions))}getUserMedia(){let e={video:{facingMode:"user",...this.MediaOptions},audio:!0},t=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia||window.getUserMedia;return navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia(e):t?new Promise((o,i)=>{t(e,s=>{o(s)},s=>{i(s)})}):Promise.reject("请检查此设备是否支持摄像头或摄像头权限是否被禁止")}closeMediaStream(e){if(typeof e.stop=="function")e.stop();else{let t=e.getAudioTracks();t&&t.length&&t.forEach(i=>{typeof i.stop=="function"&&i.stop()});let o=e.getVideoTracks();o&&o.length&&o.forEach(i=>{typeof i.stop=="function"&&i.stop()})}}getBlobBase64(e){return new Promise((t,o)=>{e||o("文件格式转换失败");const i=new FileReader;i.readAsDataURL(e),i.onload=()=>{this.isStartRecord=!1,t(i.result)},i.onerror=s=>{o(s)},i.onabort=s=>{o(s)}})}async startRecord(){if(this.videoStream=await this.getUserMedia(),this.isStartRecord)return Promise.reject("请先停止录制视频");this.videoRecorder=new MediaRecorder(this.videoStream,this.MediaRecorderOptions),this.videoRecorder.ondataavailable=e=>{this.chunks.push(e.data)},this.videoRecorder.onstop=()=>{this.videoBlob=new Blob(this.chunks,{type:"video/mp4"}),this.chunks=[]},this.videoRecorder.start();try{this.videoEl.srcObject=this.videoStream}catch{this.videoEl.src=window.URL.createObjectURL(this.videoStream)}this.videoEl.onloadedmetadata=e=>{this.videoEl.play()},this.isStartRecord=!0}async stopRecord(){if(this.isStartRecord){this.videoRecorder.stop(),this.closeMediaStream(this.videoStream);try{this.videoEl.srcObject=null}catch{this.videoEl.src=""}this.isStartRecord=!1,await new Promise(t=>{setTimeout(()=>{t()},this.isIOS?100:1500)});let e=await this.getBlobBase64(this.videoBlob);return{file:this.videoBlob,base64:e}}else return Promise.reject("请先开始录制")}};const M=h({__name:"faceH5",setup(r){const e=c(),t=c();function o(){e.value.startRecord()}function i(){e.value.stopRecord().then(s=>{console.log(s)})}return v(()=>{e.value=new g({videoEl:t.value})}),(s,m)=>(p(),f(u,null,[d("video",{ref_key:"faceEl",ref:t,class:"face"},null,512),d("button",{onClick:o},"开始录制"),d("button",{onClick:i},"停止录制")],64))}});const b=R(M,[["__scopeId","data-v-168e3810"]]);export{b as default};
